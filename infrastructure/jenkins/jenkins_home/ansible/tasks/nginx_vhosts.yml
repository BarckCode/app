---
- name: Copying vhosts files with owner and permissions
  copy:
    src: "{{ item }}"
    dest: "{{ dest_vhosts_available_path }}/"
    owner: root
    group: root
    mode: 0644
  with_fileglob:
    - "{{ src_vhosts_path }}/*"

- name: Create a symbolic link of vhosts
  file:
    src: "{{ dest_vhosts_available_path }}/{{ item.src_dest }}"
    dest: "{{ dest_vhosts_enabled_path }}/{{ item.src_dest }}"
    owner: root
    group: root
    state: link
  loop:
    - { src_dest: helmcode_com.conf }
    - { src_dest: pre_helmcode_com.conf }
    - { src_dest: weather_helmcode_com.conf }
    - { src_dest: rick-and-morty_helmcode_com.conf }
    - { src_dest: web-infographics_helmcode_com.conf }

- name: Create a vhosts directories
  file:
    path: "/var/www/{{ item.src_dest }}"
    state: directory
  loop:
    - { src_dest: 'helmcode.com' }
    - { src_dest: 'pre_helmcode.com' }

- name: Copy of private files
  copy:
    src: "{{ item.prod_env }}"
    dest: "/var/www/{{ item.prod_vhost }}/"
    owner: root
    group: root
    mode: 0644
  loop:
    - { prod_env: "{{ src_private_files_path }}/prod.env",  prod_vhost: 'helmcode.com' }
    - { prod_env: "{{ src_private_files_path }}/test.env",  prod_vhost: 'pre_helmcode.com' }

- name: Restart ngnix
  systemd:
    name: nginx
    state: restarted
    daemon_reload: yes
